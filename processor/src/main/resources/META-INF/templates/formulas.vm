package $package;

import java.math.MathContext;
import java.math.RoundingMode;
import java.math.BigDecimal;
import java.util.logging.Logger;

import javax.annotation.Generated;

import org.bitbucket.easymath.AbstractFormulas;
import org.bitbucket.easymath.FunctionCatalog;
import org.bitbucket.easymath.logging.ResolutionLogSupplier;

@Generated("$generator")
@SuppressWarnings({"all", "warnings", "unchecked", "unused", "cast"})
public class $classname extends AbstractFormulas {

    private static Logger logger = Logger.getLogger(${classname}.class.getName());

	#foreach( $constant in ${constants} )
	  #declareConstant( $constant )
	#end

    public $classname() {
        this(new FunctionCatalog());
    }

    public $classname(FunctionCatalog catalog) {
        super(catalog);
    }
#foreach( $function in ${functions} )

    /**
     * Formula: ${function.name}=${function.formula}
     */
    public ${function.type} ${utils.uncapitalize($function.name)}( #typedArguments( ${function.inputs} )) {
        #logEntering( $function )
        #check( $function )
        
        // Function precision and rounding mode definition
		MathContext mc = new MathContext(${function.precision}, RoundingMode.${function.roundingMode});
        
        // Function resolution
        #if( ${function.inputs.empty} )
          logger.info("Resolution of ${function.name} = ${function.compiledFormula}");
        #else
          logger.info(new ResolutionLogSupplier("Resolution of ${function.name} = ${function.inputResolutionFormat}", #arguments( ${function.inputs} )));
        #end  
        #foreach( $operation in ${function.operations} )
          #declareOperation( $function $operation )
        #end
        
        logger.exiting(getClass().getName(), "${utils.uncapitalize($function.name)}", ${function.lastOperation.id});
        return ${function.lastOperation.id};
    }
#end
}
## ----------------------------------------------------------------------------
## arguments
## ----------------------------------------------------------------------------
#macro( arguments $inputs )
  #foreach( $input in ${inputs} )
    ${input.id}#if( ${foreach.hasNext} ), #end
  #end
#end
## ----------------------------------------------------------------------------
## typedArguments
## ----------------------------------------------------------------------------
#macro( typedArguments $inputs )
  #foreach( $input in ${inputs} )
    ${input.type} ${input.id}#if( ${foreach.hasNext} ), #end
  #end
#end
## ----------------------------------------------------------------------------
## logEntering
## ----------------------------------------------------------------------------
#macro( logEntering $function )
  #if( ${function.inputs.empty} )
    logger.entering(getClass().getName(), "${utils.uncapitalize(${function.name})}");
  #else
    logger.entering(getClass().getName(), "${utils.uncapitalize(${function.name})}", new Object[] {#arguments( ${function.inputs} )});
  #end
#end
## ----------------------------------------------------------------------------
## check
## ----------------------------------------------------------------------------
#macro( check $function )
  #if( ${function.type} == "BigDecimal" )
    // Method protection block
    #foreach( $input in ${function.inputs} )
      if (${input.id} == null) {
          throw new IllegalArgumentException("Argument '${input.id}' cannot be null.");
      }
    #end
  #end
#end
## ----------------------------------------------------------------------------
## declareConstant
## ----------------------------------------------------------------------------
#macro( declareConstant $constant )
  #if( ${constant.type} == "double" )
    private static final ${constant.type} ${constant.id} = ${constant.value}D;
  #else
    private static final ${constant.type} ${constant.id} = new BigDecimal("${constant.value}");
  #end
#end
## ----------------------------------------------------------------------------
## declareOperation
## ----------------------------------------------------------------------------
#macro( declareOperation $function $operation )
  #if( ${operation.class.simpleName} == "UnaryOperation" )
    #declareUnary( $operation )
  #elseif( ${operation.class.simpleName} == "BinaryOperation" )
    #declareBinary( $operation )
  #elseif( ${operation.class.simpleName} == "FunctionOperation" )
    #declareFunction( $operation )
  #else
    Operation not supported!!!!!
  #end
  logger.fine(new ResolutionLogSupplier("${function.name}=${function.getOperationResolutionFormat(${operation.text})}", ${operation.id} ));  
#end
## ----------------------------------------------------------------------------
## declareUnary
## ----------------------------------------------------------------------------
#macro( declareUnary $operation )
  #if( ${operation.type} == "double" )
    #if( ${operation.operator} == '!' )
      ${operation.type} ${operation.id} = super.fat(${operation.operand.id});
    #else
      ${operation.type} ${operation.id} = ${operation.operand.id} * (${operation.operator}1);
    #end
  #else
    #if( ${operation.operator} == '!' )
      ${operation.type} ${operation.id} = super.fat(${operation.operand.id}, mc);
    #elseif( ${operation.operator} == '-' )
      ${operation.type} ${operation.id} = ${operation.operand.id}.multiply(BigDecimal.ONE.negate(), mc);
    #else
      ${operation.type} ${operation.id} = ${operation.operand.id};
    #end
  #end  
#end
## ----------------------------------------------------------------------------
## declareBinary
## ----------------------------------------------------------------------------
#macro( declareBinary $operation )
  #if( ${operation.type} == "double" )
    #if( ${operation.operator} == '^' )
      ${operation.type} ${operation.id} = super.pow(${operation.leftOperand.id}, ${operation.rightOperand.id});
    #elseif( ${operation.operator} == '*' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id} * ${operation.rightOperand.id};
    #elseif( ${operation.operator} == '/' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id} / ${operation.rightOperand.id};
    #elseif( ${operation.operator} == '%' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id} % ${operation.rightOperand.id};
    #elseif( ${operation.operator} == '+' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id} + ${operation.rightOperand.id};
    #elseif( ${operation.operator} == '-' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id} - ${operation.rightOperand.id};
    #else
      Operator '${operation.operator}' not found!!!!!!
    #end
  #else
    #if( ${operation.operator} == '^' )
      ${operation.type} ${operation.id} = super.pow(${operation.leftOperand.id}, ${operation.rightOperand.id}, mc);
    #elseif( ${operation.operator} == '*' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id}.multiply(${operation.rightOperand.id}, mc);
    #elseif( ${operation.operator} == '/' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id}.divide(${operation.rightOperand.id}, mc);
    #elseif( ${operation.operator} == '%' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id}.remainder(${operation.rightOperand.id}, mc);
    #elseif( ${operation.operator} == '+' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id}.add(${operation.rightOperand.id}, mc);
    #elseif( ${operation.operator} == '-' )
      ${operation.type} ${operation.id} = ${operation.leftOperand.id}.subtract(${operation.rightOperand.id}, mc);
    #else
      Operator '${operation.operator}' not found!!!!!!
    #end
  #end
#end
## ----------------------------------------------------------------------------
## declareFunction
## ----------------------------------------------------------------------------
#macro( declareFunction $operation )
  #if( ${operation.type} == "double" )
    ${operation.type} ${operation.id} = super.compute("${operation.name}", #arguments( ${operation.operands} ));
  #else
    ${operation.type} ${operation.id} = super.compute("${operation.name}", mc, #arguments( ${operation.operands} ));
  #end
#end
